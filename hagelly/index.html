<!DOCTYPE html>
<html>
<head>
    <title>Horizontal gallery</title>
    <script type="text/javascript" src="./js/jquery-1.8.0.min.js"></script>
    <script type="text/javascript">


        function createGallery(images) {

            function setRowWidth(row, width) {
                row.$row.width(width);
                row.width = width;
                return row
            }

            function alignRow(row) {
                setRowWidth(row, row.$gContainer.width());
                var alpha = 1.0 * (row.width - row.margin) / row.imagesWidth;
                row.images.forEach(function (el) {
                    el.$imgContainer.width(Math.floor(el.$img.width() * alpha));
                    el.$img.css("margin-left", -Math.floor(el.$imgContainer.width() * (1.0 - alpha) / 2));
                })
            }

            function createRow($gContainer) {
                var $row = $("<div class='images-row'></div>").appendTo($gContainer);
                var row = {$row: $row, $gContainer: $gContainer, images: []};
                setRowWidth(row, $gContainer.width());
                rows.push(row);
                return row;
            }

            var     rowHeight = 200,
                    $gContainer = $("#gallery-container").empty(),
                    containerMargin = 5,
                    currentContentWidth = 0,
                    rows = [],
                    currentRow = createRow($gContainer);

            images.forEach(function (image) {
                $('<img src="' + image.uri + '" alt="" height="' + rowHeight + 'px">').load(function () {
                    var $img = $(this);
                    var $imgContainer = $("<div class='image-container'></div>");
                    currentRow.$row.append($imgContainer.append($img));
                    var imgWidth = $img.width();
                    currentRow.images.push({row: currentRow, $imgContainer: $imgContainer, $img: $img, imgWidth: imgWidth});
                    currentContentWidth += imgWidth + containerMargin;
                    if (currentContentWidth > currentRow.width) {

                        var margin = containerMargin * currentRow.images.length;
                        currentRow.imagesWidth = currentContentWidth - margin;
                        currentRow.margin = margin;
                        alignRow(currentRow);

                        if (rows.length > 1 && currentRow.width < rows[rows.length - 2].width) {
                            rows.forEach(function(row) {
                                alignRow(row)
                            })
                        }

                        currentRow = createRow($gContainer);
                        currentContentWidth = 0;
                    }
                })
            });
            return $gContainer;
        }

        $(function(){
            var images = [];
            var imagesCount = 29;
            for (var i = 1; i <= imagesCount; i++) {
                images.push({uri: "./img/" + i + ".jpg"});
            }
            createGallery(images);
            $(window).resize(function() {
                createGallery(images);
            })
        })
    </script>
    <style type="text/css">
        #gallery-wrapper {
            padding-left: 40px;
            padding-right: 40px;
        }

        #gallery-container {
            max-width: 100%;
            overflow-x: hidden;
        }
        .images-row {
            width: 100%;
            overflow-x: hidden;
        }
        .image-container {
            height: 200px;
            overflow: hidden;
            display: inline-block;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <div id="gallery-wrapper">
        <div id="gallery-container"></div>
    </div>
</body>
</html>